% Name		: Pooja Ingalagi
% BITS ID	: 2020HT01121
% Description	: This file consists of MATLAB script to analyse PPG information 
%		  and extract blood pressure related information.

% Load necessary packages
pkg load signal

% Sample signal to perform analysis on
x = [509,508,509,509,509,509,510,509,509,510,510,510,510,510,510,510,511,510,510,510,510,510,510,511,510,510,510,510,509,510,510,510,509,510,509,509,510,510,509,510,510,509,509,509,509,509,510,509,510,510,510,509,510,510,509,510,510,510,510,510,510,509,509,509,509,509,510,509,509,510,510,511,511,511,510,511,511,511,511,512,511,512,512,512,511,512,513,512,512,513,512,512,513,512,511,512,512,511,511,511,510,510,511,510,510,510,510,509,510,510,509,509,510,509,509,510,509,509,509,510,509,510,510,510,510,511,510,509,510,510,509,510,510,510,510,510,510,510,510,510,509,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,509,510,510,509,510,510,509,509,510,509,509,510,510,509,510,510,509,509,510,510,509,510,509,509,509,509,509,509,510,509,509,509,509,509,510,510,510,510,511,511,511,512,511,511,512,512,512,512,513,513,513,513,513,513,513,513,512,513,512,512,512,512,512,512,512,511,511,511,511,510,511,511,511,510,510,509,510,510,510,509,510,510,509,510,510,509,509,510,510,509,509,510,509,510,510,510,509,510,509,509,510,510,510,510,510,510,509,511,510,509,510,510,510,511,510,510,510,510,510,510,510,511,510,510,511,510,510,510,510,510,510,509,508,509,509,509,509,510,510,509,510,509,509,510,510,509,510,510,509,509,510,510,509,510,510,510,510,510,510,511,511,511,511,512,512,511,513,513,513,513,514,514,514,515,514,513,514,514,514,514,514,513,513,513,513,513,513,513,512,512,512,511,511,511,511,510,511,510,509,510,510,510,509,510,509,509,509,509,509,509,509,508,509,509,509,509,510,509,509,510,510,509,510,510,510,510,510,511,510,511,510,510,511,511,511,511,511,510,511,511,511,510,511,510,510,510,511,510,510,510,510,509,510,510,509,510,510,509,509,509,509,509,509,509,509,509,509,508,509,510,509,509,509,509,509,509,509,509,509,509,509,509,510,510,511,511,511,511,512,513,513,513,514,514,514,515,514,514,515,516,515,515,515,514,515,515,515,514,514,514,513,513,513,512,512,513,511,511,511,511,510,510,510,509,509,510,510,509,510,509,509,509,509,509,509,510,509,509,510,510,510,510,510,509,510,510,510,510,511,510,510,510,510,510,510,510,510,510,511,511,511,510,510,509,510,510,509,510,510,509,509,510,510,509,510,510,509,510,510,509,509,509,509,509,509,509,508,509,509,508,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,510,510,510,510,511,511,511,512,512,513,514,514,514,514,514,515,515,516,516,515,515,515,515,515,515,514,514,514,513,514,514,513,512,512,512,511,510,512,510,511,511,510,509,509,509,509,509,509,509,509,509,509,509,509,509,507,508,509,508,508,509,509,509,509,509,509,509,509,509,509,510,509,510,510,510,510,511,510,509,510,510,510,510,510,510,510,510,509,509,510,510,509,509,510,509,509,509,509,508,509,509,508,508,509,508,508,509,509,508,508,508,508,508,509,508,508,509,509,508,509,508,508,508,509,508,508,509,508,508,509,509,508,509,510,509,510,511,511,512,513,513,512,514,514,514,515,515,515,516,516,516,515,516,516,515,516,515,515,514,514,514,513,513,512,511,512,511,510,510,510,510,509,509,509,508,509,509,508,508,509,508,508,508,508,508,509,508,508,508,508,508,508,509,509,509,509,509,509,509,509,509,510,510,509,509,509,510,509,510,510,510,510,510,510,509,510,510,509,509,510,509,509,509,509,509,510,509,509,509,509,508,509,509,508,508,509,508,508,508,508,507,508,508,508,508,509,508,508,508,508,508,508,508,507,508,508,507,507,508,508,508,508,508,507,508,508,508,508,509,508,508,508,508,507,508,509,508,509,509,508,509,509,509,509,510,510,510,511,511,511,513,513,513,514,515,514,514,515,515,514,515,515,515,514,515,514,513,514,513,513,512,513,512,511,511,510,510,509,510,509,509,509,508,508,508,508,508,508,508,507,508,507,507,507,508,507,507,508,507,507,509,508,508,508,509,509,509,509,510,509,510,510,509,510,510,510,510,511,510,510,511,510,509,510,510,509,510,510,510,510,510,509,509,509,509,508,509,509,508,509,509,508,508,509,508,507,509,508,508,508,509,508,508,508,508,507,508,508,508,507,508,507,508,508,507,507,508,508,507,508,508,508,508,508,507,507,508,508,507,508,508,508,508,509,509,509,510,510,510,511,512,512,513,514,514,514,515,515,515,516,516,515,515,515,515,514,515,514,514,514,513,512,513,513,511,511,511,511,510,510,510,509,509,509,509,509,509,509,508,508,508,507,508,508,507,508,508,508,508,508,508,507,508,508,507,508,509,508,509,509,509,509,509,509,509,509,510,509,509,510,510,510,510,509,509,509,510,509,510,510,509,509,509,509,508,510,509,508,509,509,508,508,508,508,508,509,508,507,508,508,508,508,508,508,508,508,508,507,508,508,508,508,508,508,508,508,508,507,508,508,507,508,508,508,508,509,508,508,508,508,508,508,508,508,508,508,508,508,508,508,508,509,509,509,509,510,510,510,511,512,511,513,513,512,514,514,514,514,515,515,515,515,515,515,515,514,514,514,514,514,513,513,512,511,511,510,510,510,510,509,509,509,509,508,508,508,507,508,507,507,507,508,507,507,508,508,507,508,508,508,508,509,509,508,509,509,508,509,509,509,509,510,509,509,509,509,509,509,510,509,509,510,510,509,510,509,509,509,509,509,509,509,509,508,509,509,508,509,508,507,508,508,508,508,509,508,508,509,508,508,508,509,508,508,508,508,508,509,509,508,508,508,507,508,508,508,508,508,508,508,508,508,507,508,508,508,508,508,508,508,508,508,507,508,508,507,508,508,507,507,508,508,508,508,508,507,508,508,508,508,509,508,509,509,509,510,510,510,511,511,513,513,513,514,514,513,515,515,514,515,515,515,514,515,514,514,514,513,513,513,513,512,511,512,511,511,510,510,509,509,509,508,509,509,508,508,508,508,507,508,508,507,507,508,507,507,508,508,507,508,508,507,508,508,508,508,508,508,508,508,508,508,509,509,509,509,509,509,509,509,509,508,508,508,508,509,509,508,509,509,508,508,508,508,508,508,508,507,508,509,508,508,508,508,508,508,509,508,508,509,508,508,509,508,507,508,508,507,507,508,508,508,508,507,507,508,508,507,508,508,507,508,508,508,508,508,508,508,508,509,508,508,509,509,508,509,508,508,508,508,508,508,509,508,508,509,508,508,509,508,508,509,509,509,510,511,510,511,511,511,511,513,513,513,513,514,514,514,515,514,514,514,514,514,514,514,513,513,513,513,512,512,511,510,511,511,509,510,510,509,509,509,509,508,508,507,507,508,508,507,507,507,507,507,507,507,506,508,508,508,508,509,508,507,509,508,508,508,509,508,509,509,509,509,510,509,509,509,509,509,509,510,509,509,510,509,509,509,509,509,509,509,509,508,509,508,508,509,508,507,508,508,508,508,508,508,507,508,508,507,507,507,507,507,508,507,507,508,507,506,507,507,507,508,508,508,508,509,509,507,509,508,508,508,508,507,508,508,508,508,509,508,508,509,509,509,509,511,510,511,511,511,512,513,512,512,513,514,513,513,514,513,512,514,513,512,513,513,512,511,512,511,511,511,510,509,510,510,509,509,510,508,508,509,508,507,508,508,508,508,508,508,508,508,508,507,509,509,508,508,508,508,508,509,508,508,509,509,508,508,509,508,508,509,508,509,509,509,508,509,509,508,509,509,509,509,509,508,508,509,509,509,509,509,509,509,510,508,509,509,509,508,509,508,508,508,509,508,508,508,508,507,509,508,508,508,508,508,507,509,508,507,509,508,507,508,508,507,508,509,508,508,509,509,508,510,510,511,511,512,512,513,514,514,514,515,516,516,516,516,515,515,515,514,514,514,513,513,513,512,512,511,511,510,510,510,509,508,508,508,508,508,508,507,508,508,507,506,507,507,507,507,508,507,508,509,507,508,508,508,507,508,509,508,508,508,508,508,509,509,508,509,509,508,509,509,508,509,509,509,508,509,509,508,509,509,508,509,509,509,508,509,508,508,509,510,509,510,510,509,510,511,510,511,511,511,510,511,511,510,510,509,510,511,512,512,511,509,510,508,508,507,506,505,505,505,504,505,505,505,505,507,507,507,507,509,510,511,510,511,513,514,513,514,515,515,514,515,514,515,514,514,514,514,515,514,514,514,513,512,512,512,510,510,510,509,508,508,508,507,507,508,507,507,508,507,508,509,508,508,508,509,509,511,512,512,513,514,515,513,514,514,513,513,513,512,512,514,514,514,514,514,512,511,510,509,507,507,503,504,503,508,508,510,511,510,508,511,509,509,509,506,509,509,507,504,505,509,507,507,511,508,513,511,509,507,506,505,504,504,503,503,502,503,503,503,502,503,503,503,504,505,505,506,506,505,507,507,507,508,508,508,509,510,511,511,512,512,511,514,514,514,514,515,516,515,515,516,515,516,515,514,514,514,514,513,514,514,513,514,514,513,513,513,514,514,514,514,514,514,515,514,512,508,507,507,511,513,509,510,515,509,517,512,517,525,522,524,525,517,519,515,513,509,508,506,508,506,505,504,503,502,502,501,500,500,501,500,501,502,503,502,504,504,503,505,506,505,506,508,508,508,509,498,506,521,532,529,521,526,529,528,525,532,527,521];

% Extract a subset of sample which is cleaner and consistent
xroi = x(400:1500);

% Perform FFT to get frequency components.
% Heart pulse usually fall in lower range of the frequencies.
% Hence by performing FFT, the heart pulse can be filtered from the noise.
% Also, the systolic and diastolic pulses have different frequencies
% by performing FFT we can extract them as well
XF = abs(fft(xroi));

% Extract lower frequency range as mentioned above
% and perform inverse FFT which will result in time domain amplitude
xt = ifft(XF(1:100));

% Removing the base offset from the extracted sample will result in
% the differential ammplitude of the pulse which also represents the
% strength of the pulse which is proportional to Blood Pressure
xt = xt - min(xt);

% Visualise audio samples
subplot(2,2,1); plot(x); grid on;
xlabel("Time"); ylabel("Sensor output raw"); title("Original samples");

subplot(2,2,2); plot(xroi); grid on;
xlabel("Time"); ylabel("Sensor output"); title("Region of interest");

subplot(2,2,3); stem(XF); grid on;
xlabel("Frequency"); ylabel("Amplitude"); title("FFT of Signal");

subplot(2,2,4); stem(xt(1:length(xt)/2)); grid on;
xlabel("Time"); ylabel("Differential Amplitude"); title("Differential Signal in time domain");
